<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æˆ°ç•¥é€£ç·šï¼šå› æœé­”æ³•ä¸–ç•Œç ´å†°ä»»å‹™</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@500;700;900&display=swap');

        :root { 
            --p1: #00f2fe; 
            --p2: #4facfe; 
            --accent: #ff007a; 
            --bg: #050a14; 
            --gold: #f9d423;
            --text-bright: #ffffff;
            --text-dim: #cbd5e1;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }

        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            background: var(--bg); 
            color: var(--text-dim); 
            margin: 0; 
            display: flex; 
            justify-content: center; 
            align-items: flex-start;
            min-height: 100vh;
            overflow-x: hidden;
            padding: 10px 0;
            -webkit-text-size-adjust: 100%;
        }

        .container { 
            width: 96%; 
            max-width: 500px; 
            background: rgba(15, 23, 42, 0.96); 
            padding: 1rem; 
            border-radius: 24px; 
            border: 2px solid var(--p1); 
            box-shadow: 0 0 40px rgba(0, 242, 254, 0.2); 
            text-align: center;
            position: relative;
        }

        h1 { font-size: 1.15rem; color: var(--text-bright); margin-bottom: 0.3rem; letter-spacing: 1px; font-weight: 900; }
        .subtitle { font-size: 0.7rem; color: var(--p1); margin-bottom: 0.8rem; letter-spacing: 1px; font-weight: 700; }

        .screen { display: none; }
        .active { display: block; animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

        .nav-bar { display: flex; justify-content: flex-start; margin-bottom: 8px; }
        .btn-back { color: #64748b; font-size: 0.75rem; font-weight: 700; cursor: pointer; display: flex; align-items: center; gap: 5px; padding: 5px 0; }

        /* è¡¨å–®æ¨£å¼ */
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; text-align: left; margin-bottom: 10px; }
        .form-item { text-align: left; margin-bottom: 5px; }
        .form-item label { display: block; font-size: 0.55rem; color: var(--p1); font-weight: 900; margin-bottom: 2px; }
        
        .form-item input, .form-item textarea, .form-item select {
            width: 100%;
            background: #1e293b; 
            border: 1px solid rgba(0, 242, 254, 0.3);
            border-radius: 6px;
            padding: 6px 8px;
            color: #fff;
            font-size: 0.8rem;
            font-family: inherit;
        }
        .form-item select option { background: #1e293b; color: #ffffff; }
        .form-full { grid-column: span 2; }

        /* æ•¸ä½åç‰Œ */
        .crystal-card {
            background: linear-gradient(145deg, #1e293b, #050a14);
            border: 1px solid var(--p1);
            border-radius: 16px;
            padding: 12px;
            margin: 8px 0;
            text-align: left;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            position: relative;
        }
        .crystal-card::after {
            content: "æˆ°ç•¥æª”æ¡ˆ";
            position: absolute; top: 10px; right: 12px;
            font-size: 0.5rem; color: var(--p1); opacity: 0.4; font-weight: 900;
        }
        .info-row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 6px; border-bottom: 1px solid rgba(0,242,254,0.1); padding-bottom: 4px; }
        .info-tag { font-size: 0.55rem; color: var(--p1); font-weight: 900; opacity: 0.8; }
        .info-val { font-size: 0.75rem; color: #fff; font-weight: 700; margin-top: 1px; }
        .info-long { font-size: 0.7rem; color: #cbd5e1; line-height: 1.4; margin-top: 2px; }

        /* åŒæ­¥é€²åº¦æ¢ */
        .game-progress-bar { display: flex; gap: 6px; margin: 10px 0; justify-content: center; }
        .game-dot { width: 35px; height: 5px; background: rgba(255,255,255,0.1); border-radius: 3px; transition: 0.3s; }
        .game-dot.fill { background: var(--gold); box-shadow: 0 0 8px var(--gold); }

        /* äº’å‹•å°è©±ç›’ */
        .game-box {
            background: rgba(249, 212, 35, 0.08);
            border: 2px solid var(--gold);
            padding: 18px;
            border-radius: 12px;
            margin: 10px 0;
            color: var(--gold);
            font-weight: 900;
            font-size: 0.95rem;
            line-height: 1.6;
            text-align: left;
            min-height: 110px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
        }
        .game-box::before {
            content: "ğŸ—£ï¸ åœ˜éšŠå°è©±ä»»å‹™";
            position: absolute; top: -11px; left: 15px;
            background: var(--gold); color: #000;
            font-size: 0.6rem; padding: 2px 8px; border-radius: 4px; font-weight: 900;
        }

        .trait-list { margin: 5px 0; padding-left: 18px; font-size: 0.8rem; color: #fff; list-style-type: none; }
        .trait-list li { position: relative; margin-bottom: 2px; }
        .trait-list li::before { content: "â–¹"; position: absolute; left: -15px; color: var(--p1); }

        .relay-template {
            background: rgba(0,0,0,0.4);
            padding: 10px;
            border-radius: 8px;
            color: var(--p1);
            font-family: 'monospace';
            font-size: 0.85rem;
            border: 1px dashed var(--p1);
            margin-top: 8px;
        }

        /* è·ä½é¸æ“‡ */
        .role-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin: 10px 0; }
        .role-item { 
            background: rgba(255,255,255,0.05); 
            border: 1px solid rgba(0, 242, 254, 0.3); 
            padding: 10px; border-radius: 12px; cursor: pointer; text-align: left; min-height: 80px;
        }
        .role-item.selected { background: var(--p1); border-color: #fff; color: #000; box-shadow: 0 0 15px var(--p1); }
        .role-name { font-weight: 900; font-size: 0.8rem; margin-bottom: 3px; display: block; }
        .role-desc { font-size: 0.6rem; color: #94a3b8; line-height: 1.2; }
        .role-item.selected .role-desc { color: #333; }

        /* åµéŒ¯é¸é …æŒ‰éˆ•æ¨£å¼ */
        .quiz-opt-btn { 
            display: block; width: 100%; padding: 1.1rem; margin: 8px 0; 
            background: rgba(255,255,255,0.08); border: 1.5px solid rgba(255,255,255,0.2); 
            border-radius: 14px; color: #fff; text-align: center; cursor: pointer; 
            font-size: 0.95rem; font-weight: 700; transition: 0.2s;
        }
        .quiz-opt-btn.selected { border-color: var(--gold); background: rgba(249, 212, 35, 0.25); box-shadow: 0 0 15px rgba(249, 212, 35, 0.1); }

        .btn-cta { background: var(--gold); color: #000; border: none; padding: 0.9rem; border-radius: 10px; font-size: 1rem; font-weight: 900; width: 100%; cursor: pointer; margin-top: 10px; transition: 0.2s; }
        .btn-cta:disabled { opacity: 0.3; cursor: not-allowed; }

        #scanner-ui { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(5, 10, 20, 0.9); display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 1000; border-radius: 24px; }
        .scan-line { width: 85%; height: 2px; background: var(--p1); box-shadow: 0 0 20px var(--p1); animation: scanLoop 1.5s ease-in-out infinite; }
        @keyframes scanLoop { 0%, 100% { transform: translateY(-40px); } 50% { transform: translateY(40px); } }
    </style>
</head>
<body>

<div class="container" id="app">
    <div id="scanner-ui"><div class="scan-line"></div><div style="margin-top:20px; font-family:'Noto Sans TC'; color:var(--p1); font-weight:900;">è³‡æ–™åŒæ­¥åˆ†æä¸­...</div></div>

    <!-- éšæ®µä¸€ï¼šèº«åˆ†å»ºç«‹ -->
    <div id="screen-1" class="screen active">
        <h1>èº«åˆ†è­˜åˆ¥é‡‘é‘°</h1>
        <div class="subtitle">ç¬¬ä¸€æ­¥ï¼šåŒæ­¥å€‹äººæˆ°ç•¥ç‰¹è³ª</div>
        
        <div class="form-grid">
            <div class="form-item"><label>å§“å / ä¾†è‡ªå“ªè£¡</label><input type="text" id="in-name" placeholder="ä¾‹ï¼šæ—åŒå­¸ / å°åŒ—"></div>
            <div class="form-item"><label>äººæ ¼é¡å‹ (MBTI)</label><input type="text" id="in-mbti" placeholder="ä¾‹ï¼šENTP"></div>
            
            <div class="form-item">
                <label>æ‰‹è¶³æ’è¡Œ</label>
                <select id="in-sibling">
                    <option value="ç¨ç”Ÿå­å¥³">ç¨ç”Ÿå­å¥³</option>
                    <option value="è€å¤§ (æœ‰å¼Ÿå¦¹)">è€å¤§</option>
                    <option value="è€ä¹ˆ (æœ‰å…„å§)">è€ä¹ˆ</option>
                    <option value="æ’è¡Œä¸­é–“">æ’è¡Œä¸­é–“</option>
                    <option value="æœ‰å“¥å“¥">æœ‰å“¥å“¥</option>
                    <option value="æœ‰å§Šå§Š">æœ‰å§Šå§Š</option>
                    <option value="æœ‰å¼Ÿå¼Ÿ">æœ‰å¼Ÿå¼Ÿ</option>
                    <option value="æœ‰å¦¹å¦¹">æœ‰å¦¹å¦¹</option>
                    <option value="é›™èƒèƒ">é›™èƒèƒ</option>
                </select>
            </div>
            <div class="form-item">
                <label>æœƒå¹¾ç¨®èªè¨€</label>
                <select id="in-language">
                    <option value="1ç¨®">1 ç¨®</option>
                    <option value="2ç¨®">2 ç¨®</option>
                    <option value="3ç¨®ä»¥ä¸Š">3 ç¨®ä»¥ä¸Š</option>
                </select>
            </div>

            <div class="form-item"><label>æœ€å²å®³ç§‘ç›®</label><input type="text" id="in-subject" placeholder="ä¾‹ï¼šè‡ªç„¶ / æ•¸å­¸"></div>
            <div class="form-item">
                <label>æ¨‚å™¨å°ˆé•·</label>
                <select id="in-music">
                    <option value="æœ‰å­¸éæ¨‚å™¨">æœ‰å­¸é (Yes)</option>
                    <option value="ç„¡å­¸éæ¨‚å™¨">æ²’å­¸é (No)</option>
                </select>
            </div>

            <div class="form-item form-full">
                <label>ç¤¾åœ˜ç¶“é©—</label>
                <select id="in-club">
                    <option value="é‹å‹•é¡ / æ’çƒ">é‹å‹•é¡ / æ’çƒ</option>
                    <option value="é‹å‹•é¡ / ç±ƒçƒ">é‹å‹•é¡ / ç±ƒçƒ</option>
                    <option value="é‹å‹•é¡ / å…¶ä»–">é‹å‹•é¡ / å…¶ä»–</option>
                    <option value="åº·è¼”é¡ / å‰ä»–">åº·è¼”é¡ / å‰ä»–</option>
                    <option value="åº·è¼”é¡ / ç†±èˆ">åº·è¼”é¡ / ç†±èˆ</option>
                    <option value="åº·è¼”é¡ / åº·è¼”ç¤¾">åº·è¼”é¡ / åº·è¼”ç¤¾</option>
                    <option value="å­¸è¡“ / å­¸ç”Ÿæœƒ">å­¸è¡“ / å­¸ç”Ÿæœƒ</option>
                    <option value="å¿—å·¥é¡ / å¿—å·¥ç¤¾">å¿—å·¥é¡ / å¿—å·¥ç¤¾</option>
                    <option value="æ²’åƒåŠ ç¤¾åœ˜">æ²’åƒåŠ ç¤¾åœ˜</option>
                </select>
            </div>

            <div class="form-item form-full"><label>èˆˆè¶£èˆ‡æ„›å¥½</label><input type="text" id="in-hobby" placeholder="ä½ å¹³å¸¸æœ€å–œæ­¡åšä»€éº¼ï¼Ÿ"></div>
            <div class="form-item form-full"><label>å ±åå‹•æ©Ÿ</label><textarea id="in-motive" placeholder="ç‚ºä»€éº¼å ±ååƒåŠ é€™æ¬¡ç‡ŸéšŠï¼Ÿ" style="height: 40px;"></textarea></div>
        </div>

        <button class="btn-cta" onclick="finishTask1()">åŒæ­¥è³‡æ–™ä¸¦ç”Ÿæˆæ•¸ä½åç‰Œ</button>
    </div>

    <!-- éšæ®µäºŒï¼šå°è©±ä»»å‹™ -->
    <div id="screen-2" class="screen">
        <div class="nav-bar"><div class="btn-back" onclick="handleSocialBack()">â† ä¸Šä¸€æ­¥</div></div>
        <h1>æˆ°ç•¥å¤¥ä¼´è­˜åˆ¥</h1>
        <div class="subtitle" id="social-stage-title">ç¬¬äºŒæ­¥ï¼šç¬¬ä¸€é—œåŒæ­¥</div>
        
        <div class="game-progress-bar">
            <div class="game-dot" id="dot-0"></div>
            <div class="game-dot" id="dot-1"></div>
            <div class="game-dot" id="dot-2"></div>
        </div>

        <!-- åç‰Œå±•ç¤º -->
        <div class="crystal-card">
            <div class="info-row">
                <div class="crystal-info"><div class="info-tag">å§“å</div><div class="info-val"><span id="out-name"></span></div></div>
                <div class="crystal-info"><div class="info-tag">äººæ ¼é¡å‹</div><div class="info-val" id="out-mbti"></div></div>
            </div>
            <div class="info-row">
                <div class="crystal-info"><div class="info-tag">æ“…é•·ç§‘ç›®</div><div class="info-val" id="out-subject"></div></div>
                <div class="crystal-info"><div class="info-tag">æ‰‹è¶³ç‹€æ³</div><div class="info-val" id="out-sibling"></div></div>
            </div>
            <div class="info-row">
                <div class="crystal-info"><div class="info-tag">èªè¨€ / æ¨‚å™¨</div><div class="info-val"><span id="out-language"></span> / <span id="out-music"></span></div></div>
                <div class="crystal-info"><div class="info-tag">ç¤¾åœ˜ç¶“æ­·</div><div class="info-val" id="out-club"></div></div>
            </div>
            <div style="text-align:left; padding: 2px 0;">
                <div class="info-tag">èˆˆè¶£æ„›å¥½</div>
                <div class="info-long" id="out-hobby"></div>
            </div>
            <div style="text-align:left; padding: 2px 0; border-top: 1px solid rgba(0,242,254,0.1); margin-top: 4px;">
                <div class="info-tag">å ±åå‹•æ©Ÿ</div>
                <div class="info-long" id="out-motive"></div>
            </div>
        </div>

        <div class="game-box" id="social-mission-txt">æ­£åœ¨è¼‰å…¥ä»»å‹™...</div>

        <button class="btn-cta" id="next-stage-btn" onclick="nextSocialStep()">å°è©±å®Œç•¢ï¼Œä¸‹ä¸€é—œ</button>
    </div>

    <!-- éšæ®µä¸‰ï¼šè·ä½åˆ†é… -->
    <div id="screen-3" class="screen">
        <div class="nav-bar"><div class="btn-back" onclick="navTo(2)">â† è¿”å›åŒæ­¥å°è©±</div></div>
        <h1>æˆ°ç•¥è·ä½åˆ†é…</h1>
        <div class="subtitle">ç¬¬ä¸‰æ­¥ï¼šèªé ˜é—œéµè·èƒ½</div>
        <p style="font-size: 0.8rem; color: #94a3b8; margin-bottom: 12px;">è§€å¯Ÿå¤¥ä¼´åç‰Œå¾Œï¼Œè«‹èªé ˜ä¸€å€‹æˆ°ç•¥ä½ç½®ï¼š</p>
        
        <div class="role-grid">
            <div class="role-item" onclick="pickRole('causal', this)"><span class="role-name">ğŸ•µï¸ å› æœæ´å¯Ÿæ‰‹</span><span class="role-desc">æä¾›æ•¸æ“šèƒŒæ™¯ã€‚</span></div>
            <div class="role-item" onclick="pickRole('logic', this)"><span class="role-name">ğŸ“Š æ•¸æ“šé‚è¼¯å®˜</span><span class="role-desc">æ’é™¤å½ç›¸é—œæ•¸æ“šã€‚</span></div>
            <div class="role-item" onclick="pickRole('innovation', this)"><span class="role-name">ğŸš€ å‰µæ–°è§£ç¢¼å“¡</span><span class="role-desc">å°‹æ‰¾éš±è—é—œè¯ã€‚</span></div>
            <div class="role-item" onclick="pickRole('leadership', this)"><span class="role-name">ğŸ‘‘ æˆ°ç•¥æŒ‡æ®å®˜</span><span class="role-desc">æ•´åˆè³‡è¨Šä¸¦æ±ºå®šã€‚</span></div>
        </div>

        <button class="btn-cta" id="start-mission-btn" onclick="startRounds()" disabled>é€²å…¥æœ€çµ‚åµéŒ¯æŒ‘æˆ°</button>
    </div>

    <!-- éšæ®µå››ï¼šå› æœæŒ‘æˆ° -->
    <div id="screen-4" class="screen">
        <div class="nav-bar"><div class="btn-back" onclick="handleMissionBack()">â† ä¸Šä¸€æ­¥</div></div>
        <div id="round-info" style="font-family:'Noto Sans TC'; color:var(--p1); font-size:0.75rem; margin-bottom:8px;">ä»»å‹™é—œå¡ 1 / 3</div>
        
        <div class="case-box">
            <div class="case-tag">æ•¸æ“šæµåˆ†æ</div>
            <div class="case-txt" id="case-content-txt">è¼‰å…¥æ•¸æ“šä¸­...</div>
        </div>

        <div class="fragment-hint" id="role-fragment">æ­£åœ¨ç²å–æƒ…å ±ç¢ç‰‡...</div>

        <div id="quiz-area">
            <p style="font-size: 0.85rem; color: var(--gold); font-weight: 900; margin-bottom: 8px;">ğŸ“¢ å”¸å‡ºç·šç´¢ï¼Œé”æˆåœ˜éšŠå…±è­˜å¾Œæäº¤ï¼š</p>
            <div id="opt-box"></div>
            <button class="btn-cta" id="btn-submit" onclick="submitAns()" disabled>ç¢ºèªåœ˜éšŠå…±è­˜ä¸¦æäº¤</button>
        </div>
    </div>

    <!-- çµ‚ç«  -->
    <div id="screen-final" class="screen">
        <h1>ä»»å‹™åœ“æ»¿å®Œæˆ</h1>
        <div style="font-size: 3.2rem; color: var(--gold); font-weight: 900; margin: 15px 0;" id="final-pts">0</div>
        <div class="quest-card" style="border: 1px solid var(--p1); padding: 15px; border-radius: 12px;">
            <span class="subtitle" style="margin-bottom: 5px; display: block; font-size: 0.7rem;">åœ˜éšŠé­”æ³•å…±é³´è©•åƒ¹</span>
            <div id="eval-text-final" style="font-size: 0.9rem; color: #fff; line-height: 1.5; font-weight: 700;">æ­£åœ¨çµç®—è©•åƒ¹...</div>
        </div>
        <button class="btn-cta" onclick="resetGame()">é‡æ–°å•Ÿå‹•ä¸–ç•Œç·š</button>
    </div>
</div>

<script>
    let myIdentity = {};
    let myRole = null;
    let currentIdx = 0;
    let totalScore = 0;
    let chosenIdx = null;
    let socialStep = 0;

    function updateSocialUI() {
        const titleEl = document.getElementById('social-stage-title');
        const missionEl = document.getElementById('social-mission-txt');
        const dots = document.querySelectorAll('.game-dot');
        const btn = document.getElementById('next-stage-btn');

        dots.forEach((dot, idx) => idx <= socialStep ? dot.classList.add('fill') : dot.classList.remove('fill'));

        if (socialStep === 0) {
            titleEl.innerText = "ç¬¬äºŒæ­¥ï¼šç¬¬ä¸€é—œ å…¨çµ„æƒæ";
            missionEl.innerHTML = `
                <div style="font-size:0.85rem; color:var(--p1); margin-bottom:5px;">è«‹å¿«é€Ÿæƒæé€™æ¡Œå¤¥ä¼´çš„åç‰Œï¼Œè¨˜ä½æ¯å€‹äººçš„<b>åå­—</b>èˆ‡ä»¥ä¸‹ç‰¹è³ªï¼š</div>
                <ul class="trait-list">
                    <li>å­¸éæ¨‚å™¨çš„äºº / æ“…é•·é‹å‹•çš„äºº</li>
                    <li>æ“…é•·è‡ªç„¶ã€æ•¸å­¸æˆ–è‹±æ–‡çš„äºº</li>
                    <li>äººæ ¼é¡å‹æ˜¯ E äººæˆ– I äºº</li>
                    <li>ä¾†è‡ªã€Œå°å—ä»¥å¤–ã€ç¸£å¸‚çš„äºº</li>
                    <li>æœ‰ç¤¾åœ˜ç¶“é©—çš„äºº</li>
                </ul>
                <div style="font-size:0.75rem; color:var(--accent); margin-top:5px; font-weight:900;">ğŸ“¢ æé†’ï¼šæƒæå®Œå…¨çµ„å†æŒ‰ä¸‹ä¸€æ­¥å–”ï¼</div>
            `;
            btn.innerText = "æƒæå®Œç•¢ï¼Œä¸‹ä¸€é—œ";
        } else if (socialStep === 1) {
            titleEl.innerText = "ç¬¬äºŒæ­¥ï¼šç¬¬äºŒé—œ åˆ†é‚Šé€£ç·š";
            missionEl.innerHTML = `
                <div style="font-size:0.85rem; color:var(--p1); margin-bottom:8px;">è«‹ä¾æ“šæ¡Œå­çš„<b>ã€Œå·¦åŠé‚Šã€</b>èˆ‡<b>ã€Œå³åŠé‚Šã€</b>å„è‡ªæˆçµ„ï¼š</div>
                <div style="color:#fff; font-size:0.85rem; border: 1px dashed var(--gold); padding: 10px; margin-bottom: 8px; line-height:1.5;">
                    å‘çµ„å…§å¤¥ä¼´äº¤æµä½ çš„<b>ã€Œå ±åå‹•æ©Ÿã€</b>èˆ‡<b>ã€Œèˆˆè¶£æ„›å¥½ã€</b>ï¼Œä¸¦èŠèŠå‰é¢å¡«å¯«çš„<b>æ‰‹è¶³ç‹€æ³æˆ–ç¤¾åœ˜ç¶“é©—</b>ã€‚
                </div>
                <div style="font-size:0.8rem; color:var(--gold); line-height:1.4;">
                    ğŸ’¡ <b>å°è©±è¦å‰‡ï¼š</b><br>
                    æ¯äººåˆ†äº«ç´„ 30 ç§’ï¼Œå…¶ä»–äººè² è²¬è†è½ã€‚å¤§å®¶éƒ½è¦è¬›åˆ°è©±å–”ï¼
                </div>
                <div style="font-size:0.75rem; color:var(--accent); margin-top:8px;">äº¤æµå®Œç•¢å¾Œè«‹é»æ“Šä¸‹ä¸€æ­¥ã€‚</div>
            `;
            btn.innerText = "äº¤æµå®Œç•¢ï¼Œä¸‹ä¸€é—œ";
        } else {
            titleEl.innerText = "ç¬¬äºŒæ­¥ï¼šç¬¬ä¸‰é—œ è¨˜æ†¶é€£é–";
            missionEl.innerHTML = `
                <div style="font-size:0.85rem; color:var(--p1); margin-bottom:8px;">å…¨çµ„ï¼ˆ5äººï¼‰æŒ‰é †åºé€²è¡Œã€Œåå­—è¨˜æ†¶æ¥é¾ã€ï¼š</div>
                <div style="color:#fff; font-size:0.85rem;">ç”±ä¸€äººé–‹å§‹ï¼Œä¾åºè¬›å‡ºå‰é¢æ‰€æœ‰äººçš„åå­—ï¼š</div>
                <div class="relay-template">
                    ç¬¬ä¸€äººï¼šæˆ‘æ˜¯ [è‡ªå·±çš„åå­—]<br>
                    ç¬¬äºŒäººï¼šä»–æ˜¯ [ç¬¬ä¸€äºº]ï¼Œæˆ‘æ˜¯ [è‡ªå·±çš„åå­—]<br>
                    ç¬¬ä¸‰äººï¼šä»–æ˜¯ [ç¬¬ä¸€äºº]ï¼Œä»–æ˜¯ [ç¬¬äºŒäºº]ï¼Œæˆ‘æ˜¯ [è‡ªå·±çš„åå­—]...
                </div>
                <div style="font-size:0.8rem; color:#cbd5e1; margin-top:10px;">é€™æ˜¯ä¸€å ´åœ˜éšŠæŒ‘æˆ°ï¼Œè¨˜ä¸ä½æ™‚å¤¥ä¼´å¯ä»¥å°è²æç¤ºï¼</div>
            `;
            btn.innerText = "é€£é–æˆåŠŸï¼Œå‰å¾€è·ä½åˆ†é…";
        }
    }

    function navTo(n) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        const target = document.getElementById(`screen-${n}`);
        if(target) target.classList.add('active');
        if(n === 2) updateSocialUI();
    }

    function handleSocialBack() {
        if (socialStep > 0) { socialStep--; updateSocialUI(); } 
        else { navTo(1); }
    }

    function handleMissionBack() {
        if (currentIdx > 0) { currentIdx--; renderRound(); } 
        else { navTo(3); }
    }

    function nextSocialStep() {
        if(socialStep < 2) { socialStep++; updateSocialUI(); } 
        else { navTo(3); }
    }

    function finishTask1() {
        const name = document.getElementById('in-name').value;
        const mbti = document.getElementById('in-mbti').value;
        if(!name || !mbti) { alert("è«‹å¡«å¯«å§“åèˆ‡ MBTIï¼"); return; }
        
        myIdentity = { 
            name, mbti, 
            subject: document.getElementById('in-subject').value || "æœªå¡«å¯«", 
            sibling: document.getElementById('in-sibling').value, 
            language: document.getElementById('in-language').value,
            music: document.getElementById('in-music').value,
            club: document.getElementById('in-club').value,
            hobby: document.getElementById('in-hobby').value || "æœªå¡«å¯«", 
            motive: document.getElementById('in-motive').value || "æœªå¡«å¯«"
        };

        document.getElementById('out-name').innerText = myIdentity.name;
        document.getElementById('out-mbti').innerText = myIdentity.mbti;
        document.getElementById('out-subject').innerText = myIdentity.subject;
        document.getElementById('out-sibling').innerText = myIdentity.sibling;
        document.getElementById('out-language').innerText = myIdentity.language;
        document.getElementById('out-music').innerText = myIdentity.music;
        document.getElementById('out-club').innerText = myIdentity.club;
        document.getElementById('out-hobby').innerText = myIdentity.hobby;
        document.getElementById('out-motive').innerText = myIdentity.motive;
        
        socialStep = 0;
        navTo(2);
    }

    function pickRole(r, el) {
        myRole = r;
        document.querySelectorAll('.role-item').forEach(i => i.classList.remove('selected'));
        el.classList.add('selected');
        document.getElementById('start-mission-btn').disabled = false;
    }

    function startRounds() { currentIdx = 0; totalScore = 0; navTo(4); renderRound(); }

    function renderRound() {
        const database = [
            { q: "ç•°å¸¸ï¼šå†°æ·‡æ·‹éŠ·é‡è¶Šé«˜æ™‚ï¼Œæººæ°´äººæ•¸ä¹Ÿè¶Šé«˜ã€‚", 
              frags: { causal: "ğŸ•µï¸ æ´å¯Ÿæ‰‹ï¼šè³‡æ–™é¡¯ç¤ºæººæ°´é«˜å³°æœŸéƒ½åœ¨ 7-8 æœˆå¤å­£ã€‚", logic: "ğŸ“Š é‚è¼¯å®˜ï¼šæ•¸æ“šé¡¯ç¤ºå†°æ·‡æ·‹ä¸¦ä¸å«å°è‡´æŠ½ç­‹çš„æˆåˆ†ã€‚", innovation: "ğŸš€ è§£ç¢¼å“¡ï¼šç›£æ¸¬ç™¼ç¾é˜²æ›¬ä¹³éŠ·é‡ä¹Ÿåœ¨æ­¤æ™‚åŒæ­¥é£†å‡ã€‚", leadership: "ğŸ‘‘ å…©è€…çœŸçš„æœ‰å› æœé—œä¿‚å—ï¼Ÿé‚„æ˜¯æœ‰å¦ä¸€å€‹ã€Œéš±è—è®Šå› ã€å½±éŸ¿å…©è€…ï¼Ÿ" },
              opts: ["å†°æ·‡æ·‹æ¶ˆè€—é«”åŠ›", "å¤å­£é«˜æº« (éš±è—ä¸»å› )", "æ¸¸æ³³æ± åŒ…è£æ±¡æŸ“"], win: 1 },
            { q: "ç•°å¸¸ï¼šå®¶è£¡æ›¸ç±æ•¸é‡è¶Šå¤šçš„å°å­©ï¼Œæˆç¸¾é€šå¸¸è¶Šå¥½ã€‚", 
              frags: { causal: "ğŸ•µï¸ æ´å¯Ÿæ‰‹ï¼šå¯¦é©—ç™¼ç¾å–®ç´”å¢åŠ æ›¸æœ¬è€Œä¸å»é–±è®€ï¼Œæˆç¸¾ä¸¦ä¸æœƒæå‡ã€‚", logic: "ğŸ“Š é‚è¼¯å®˜ï¼šæ›¸æœ¬å¤šå¯¡åæ‡‰äº†å®¶é•·å°æ–¼æ•™è‚²ç’°å¢ƒçš„æŠ•å…¥åº¦ã€‚", innovation: "ğŸš€ é«˜è—æ›¸å®¶åº­é€šå¸¸å…·å‚™æ›´ç©©å®šçš„æˆé•·é™ªä¼´ç’°å¢ƒã€‚", leadership: "ğŸ‘‘ æ˜¯æ›¸æœ¬ç™¼å°„æ™ºæ…§æ³¢é•·ï¼Ÿé‚„æ˜¯ã€å®¶åº­è³‡æºèˆ‡ç’°å¢ƒã€æ‰æ˜¯é—œéµï¼Ÿ" },
              opts: ["æ›¸æœ¬é‡‹æ”¾æ™ºæ…§é »ç‡", "å®¶åº­èƒŒæ™¯èˆ‡ç’°å¢ƒ", "æ›¸æ¶é‡é‡å¢åŠ æ™ºå•†"], win: 1 },
            { q: "ç•°å¸¸ï¼šé†«é™¢è£¡ç©¿ç™½è¢çš„äººè¶Šå¤šï¼Œç•¶å¤©æ­»äº¡äººæ•¸è¶Šé«˜ã€‚", 
              frags: { causal: "ğŸ•µï¸ æ´å¯Ÿæ‰‹ï¼šæ­»äº¡æ¡ˆä¾‹å¤§å¤šé›†ä¸­åœ¨é‡ç—‡åŠ è­·ç—…æˆ¿(ICU)ã€‚", logic: "ğŸ“Š é‚è¼¯å®˜ï¼šçµ±è¨ˆé¡¯ç¤ºåŠ è­·ç—…æˆ¿é…ç½®çš„é†«è­·äººå“¡å¯†åº¦æ˜¯æœ€é«˜çš„ã€‚", innovation: "ğŸš€ åœ¨æ™®é€šé–€è¨ºé›–ç„¶ä¹Ÿæœ‰ç™½è¢ï¼Œä½†æ­»äº¡ç‡æ¥è¿‘é›¶ã€‚", leadership: "ğŸ‘‘ ç¦æ­¢ç©¿ç™½è¢èƒ½æ•‘äººå—ï¼Ÿé‚„æ˜¯ç™½è¢å¤šçš„åœ°æ–¹æ˜¯å› ç‚ºç—…æƒ…æœ€å±éšªï¼Ÿ" },
              opts: ["ç™½è¢å°è‡´å£“åŠ›", "é‡ç—‡å¯†åº¦èˆ‡ç—…æƒ…åš´é‡åº¦", "é†«è­·äººå“¡é«”æº«é«˜"], win: 1 }
        ];
        const data = database[currentIdx];
        chosenIdx = null;
        document.getElementById('round-info').innerText = `ä»»å‹™é—œå¡ ${currentIdx + 1} / 3`;
        document.getElementById('case-content-txt').innerText = data.q;
        document.getElementById('role-fragment').innerText = data.frags[myRole];
        document.getElementById('btn-submit').disabled = true;
        const box = document.getElementById('opt-box'); box.innerHTML = '';
        data.opts.forEach((t, i) => {
            const b = document.createElement('div');
            b.className = 'quiz-opt-btn';
            b.innerText = t;
            b.onclick = () => {
                document.querySelectorAll('.quiz-opt-btn').forEach(x => x.classList.remove('selected'));
                b.classList.add('selected');
                chosenIdx = i;
                document.getElementById('btn-submit').disabled = false;
            };
            box.appendChild(b);
        });
    }

    function submitAns() {
        if(chosenIdx === null) return;
        const s = document.getElementById('scanner-ui'); s.style.display = 'flex';
        setTimeout(() => {
            s.style.display = 'none';
            const winIndices = [1, 1, 1];
            const win = chosenIdx === winIndices[currentIdx];
            const contentEl = document.getElementById('case-content-txt');
            if(win) { totalScore += 100; contentEl.innerHTML = "<span style='color:#2ed573'>âœ… è¨ºæ–·æ­£ç¢ºï¼</span>"; }
            else { contentEl.innerHTML = "<span style='color:#ff4757'>âŒ åµæ¸¬å¤±æ•—ï¼</span>"; }
            document.querySelectorAll('.quiz-opt-btn').forEach(b => b.style.pointerEvents = 'none');
            setTimeout(() => { if(currentIdx < 2) { currentIdx++; renderRound(); } else { showFinal(); } }, 1200);
        }, 1200);
    }

    function showFinal() {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById('screen-final').classList.add('active');
        document.getElementById('final-pts').innerText = totalScore;
        let msg = totalScore === 300 ? "è¶…å‡¡å…±é³´ï¼šä½ å€‘çš„åœ˜éšŠæºé€šå®Œç¾ï¼Œæ˜¯ç ”ç™¼æœªä¾†çš„æœ€å¼·å‹•åŠ›ï¼" :
                 (totalScore >= 200 ? "æˆ°ç•¥é ˜è¢–ï¼šå·²å…·å‚™çœ‹ç©¿å¤§æ•¸æ“šå½è£çš„èƒ½åŠ›ï¼ŒçœŸç›¸å·²åœ¨çœ¼å‰ã€‚" :
                 "åˆæ­¥è¦ºé†’ï¼šè¨˜å¾—å¤šå‚¾è½å¤¥ä¼´ç·šç´¢ï¼Œæ¯å¡Šç¢ç‰‡éƒ½æ˜¯é€šå¾€çœŸç›¸çš„å”¯ä¸€é‘°åŒ™ã€‚");
        document.getElementById('eval-text-final').innerText = msg;
    }

    window.resetGame = () => {
        myIdentity = {}; myRole = null; currentIdx = 0; totalScore = 0; chosenIdx = null; socialStep = 0;
        document.querySelectorAll('input, textarea').forEach(el => el.value = "");
        document.querySelectorAll('select').forEach(el => el.selectedIndex = 0);
        document.querySelectorAll('.role-item').forEach(i => i.classList.remove('selected'));
        document.getElementById('start-mission-btn').disabled = true;
        navTo(1);
    }
</script>
</body>
</html>
